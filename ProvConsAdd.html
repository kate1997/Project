<!DOCTYPE html>
<html lang="en">
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Forest</title>
  <link rel="stylesheet" href="ProviderAdd.css ">
  <style>
  .prov{
    width:65%;
    height: 46%;
    background-color: rgba(0, 26, 11, 0.7);
    padding-left: 2%;
    padding-right: 2%;
    padding-top: 1%;
    margin-left: 20%;
    margin-top: 20%;
    
}
</style>
</head>
<body>

    <script src="index.js">
        
    </script>

<header>  
<h1> Добавление взаимосвязи </h1>


<!--Меню-->
    <ul id="nav" >
        <li>
            <a href="#" title="Меню"  id="menu" ><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/Hamburger_icon.svg/1200px-Hamburger_icon.svg.png" width="30px" height="30px"  ></a>
            <ul>
                <li><a href="SupplyScheme.html">График поставок </a></li>
                <li><a href="Consigner.html">Грузоотправители</a></li>
                <li><a href="Provider.html">Поставщики</a></li>
                <li><a href="ProvCons.html">Взаимосвязь </a></li>
                <li><a href="Wagons.html">Вагоны </a></li>
                <li><a href="ScheduleWagons.html">Расписание вагонов </a></li>
                <li><a href="page1.html">Настройки </a></li>
                <li><a href="site.html#">Главная </a></li>
            </ul>
        </li>
    </ul>

</header>
<main>
    <form class="prov" >
        <li>
            <label >Идентификатор поставщика:</label>
            <input  type="text" id="provId" name="provId">
        </li>

        <li>
                <label >Идентификатор грузоотправителя:</label>
                <input type="text" id="consId" name="consId">
        </li>

        
        <input   id ="submit" type="button" name="submit" value="Отправить" >
    <input id="return" type="button" onclick="location.href='ProvCons.html'" value="Вернуться к таблице" >
    </form>

</main>
<footer>
        <address>...</address>
        <small>@2019...</small>
  </footer>

</body>

<script type="text/javascript">
document.getElementById('submit').onclick= function (){ 
var obj; 
 
    var provId = document.getElementById('provId').value;
    var provId_par = /[0-9]+/;
    var provProvId = provId_par.test(provId);
    var consId = document.getElementById('consId').value;
    var consId_par = /[0-9]+/;
    var provConsId = consId_par.test(consId);
    
    
    if( provId == "" && consId =="" ){
       alert('Заполните поля!');
    }
    else{
       if( provId == "" || consId ==""){
          alert('Вы не заполнили одно из полей');
       }
          else{
             if(provProvId == true && provConsId == true){

                //Отправка данных на сервер
                // 1. Создаём новый объект XMLHttpRequest
                var xhr = new XMLHttpRequest();
                
                xhr.open('GET', 'http://kappa.cs.petrsu.ru/~akulov/Practice/actionsTables.php?table=provcons&provId=' + document.getElementById("provId").value + "&consId=" + document.getElementById("consId").value,false);
                
                // 3. Отсылаем запрос
                xhr.send();
                
                // 4. Если код ответа сервера не 200, то это ошибка
                if (xhr.status != 200) {
                // обработать ошибку
                console.log(xhr);
                alert( xhr.status + ': ' + xhr.statusText );  //пример вывода: 404: Not Found
                } 
                else {
                
                        if(xhr.responseText==1){
                            alert('Данные добавлены в БД');
                            }
                        else{alert('Данные не могут быть добавлены');}
                    }

                }
            else alert('Поля должны содержать только числовые значения');    
        }     
    }
location.reload();
}
</script>

</html>