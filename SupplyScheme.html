<!DOCTYPE html>
<html lang="en">
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Forest</title>
  <link rel="stylesheet" href="provider.css ">
 <style>
 #nav li:hover ul li a:hover{ /* стили для конкретных выпадающих пунктов, при наведении на них курсора */
    
    background:rgba(50,50,50,1); /* Полупрозрачность. */
   
}

#put{
  
    margin-top: 15%;
    margin-left: 4%;
    float: left;
    text-align: center;
    
}
/*заголовок списка "Тип вагона"*/
#typeWag {
    color:white;
    font-size: 20px;
   
}

/*заголовок списка месяца */
#dayWag{
    color: white;
    font-size: 20px;
    margin-top: 9%;
}




/*кнопка отчета*/
#otch{
    margin-top: 90px;
   

    padding: 10px;
    padding-left: 25px;
    padding-right: 25px;
}


 </style>
</head>
<body>

 <header> 
<h1> График поставок </h1>



<!--Меню-->
    <ul id="nav" >
        <li>
            <a href="#" title="Меню"  id="menu" ><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/Hamburger_icon.svg/1200px-Hamburger_icon.svg.png" width="30px" height="30px"  ></a>
            <ul>
                <li><a href="SupplyScheme.html">График поставок </a></li>
                <li><a href="Consigner.html">Грузоотправители</a></li>
                <li><a href="Provider.html">Поставщики</a></li>
                <li><a href="ProvCons.html">Взаимосвязь </a></li>
                <li><a href="Wagons.html">Вагоны </a></li>
                <li><a href="ScheduleWagons.html">Расписание вагонов </a></li>
                <li><a href="page1.html">Настройки </a></li>
                <li><a href="site.html#">Главная </a></li>
            </ul>
        </li>
    </ul>
 </header>

<main>
    
<section>
       
  <div id="put">
                <p id="typeWag">Выберите тип вагона</p>
                    <p><select size="1" name="type" id="type">
                    <option disabled selected></option>
    
                    </select><button id="choose">Выбрать</button></p>        
       
        <p id="dayWag">Выберите день</p>
        <p><select size="1" name="type" id="day">
        <option disabled selected></option>

        </select><button id="choose2">Выбрать</button></p>
        
 
           
       <button id="otch" onclick="location.href='diagram.html'">Отчет</button>
</div>
        <table id='mytbl'>
            <tbody id='tbody'>
                    <tr>
                        <th>Количество вагонов</th>
                        <th>Тип вагона</th>
                       
                       
                    </tr>
            </tbody>
    </table>

        
</section>


<script type="text/javascript">

var myBtn = document.getElementById('build');
var mytbl = document.getElementById('mytbl');
var tb = mytbl.querySelector('tbody');
var typeId;
var clearTable = function(countRow){
    if (countRow > 1) {
        for (i=tb.rows.length-1; i>0; i--){
            tb.deleteRow(i);
        }
    }
}

window.onload = function (){ 
 var ourObj;       
                    
//создание списка типов вагонов
        var typeWagon;

    //1. Создаём новый объект XMLHttpRequest
        var xhr = new XMLHttpRequest();
        
        xhr.open('GET', 'http://kappa.cs.petrsu.ru/~akulov/Practice/actionsFiles.php?wagon=1',false);
        
        // 3. Отсылаем запрос
        xhr.send();
        
    // 4. Если код ответа сервера не 200, то это ошибка
        if (xhr.status != 200) {
        // обработать ошибку
        console.log(xhr);
        alert( xhr.status + ': ' + xhr.statusText );  //пример вывода: 404: Not Found
        } else {
        
            typeWagon = JSON.parse(xhr.responseText);
        
        
        }
        var selector=document.getElementById('type');

        for (i = 0; i < typeWagon.length; i++) {
            for (var key in typeWagon[i]) {
            
                    selector.innerHTML+='<option id="'+key+'"  >'+key+'</option>'
                    
            }
        }

}





//работа со списком типов
var select, value, text,value;
function change() {
    
    
    alert(typeId);
}

document.getElementById('choose2').onclick=function(){

    var myBtn = document.getElementById('build');
var mytbl = document.getElementById('mytbl');
var tb = mytbl.querySelector('tbody');
clearTable(tb.rows.length);
    select2 = document.getElementById("day"); // Выбираем  select по id
    dayId=select2.selectedIndex;

    for (var i = 0; i < ourObj[dayId].length; i++) {
            //alert(ourObj[key].length);
    var tr = document.createElement('tr');
   // var id = key;

    //tr.id = `row-${id}`;
    tr.innerHTML = `
                    <td>${ourObj[dayId][i]['consName']}</td>
                    <td>${ourObj[dayId][i]['quantity']}</td>`
                    
    tb.appendChild(tr);
    }

}

//отправка данных на сервер                    
document.getElementById('choose').onclick=function(){
alert('тест');

select = document.getElementById("type"); // Выбираем  select по id
    typeId=select.selectedIndex;

 // 1. Создаём новый объект XMLHttpRequest
var xhr = new XMLHttpRequest();
                
xhr.open('GET', 'http://kappa.cs.petrsu.ru/~akulov/Practice/actionsFiles.php?table=supply&type=' + typeId,false);

// 3. Отсылаем запрос
xhr.send();
// 4. Если код ответа сервера не 200, то это ошибка
if (xhr.status != 200) {
// обработать ошибку
console.log(xhr);
alert( xhr.status + ': ' + xhr.statusText );  //пример вывода: 404: Not Found
} else {

        ourObj = JSON.parse(xhr.responseText);
    //alert(ourObj[1][0]['consName']); 
    //alert(ourObj[1].length);
   

}




/*//Получение данных с сервера 

var ourObj; 
// 1. Создаём новый объект XMLHttpRequest
var xhr = new XMLHttpRequest();

xhr.open('GET', 'http://kappa.cs.petrsu.ru/~akulov/Practice/showSupply.php',false);

// 3. Отсылаем запрос
xhr.send();

// 4. Если код ответа сервера не 200, то это ошибка
if (xhr.status != 200) {
// обработать ошибку
console.log(xhr);
alert( xhr.status + ': ' + xhr.statusText );  //пример вывода: 404: Not Found
} else {

        ourObj = JSON.parse(xhr.responseText);
    

}
*/


//построение таблицы

//Данные для таблицы
var myBtn = document.getElementById('build');
var mytbl = document.getElementById('mytbl');
var tb = mytbl.querySelector('tbody');

// event process
var clearTable = function(countRow){
    if (countRow > 1) {
        for (i=tb.rows.length-1; i>0; i--){
            tb.deleteRow(i);
        }
    }
}
//SELECT SUDA
var selector2=document.getElementById('day');
for (var key in ourObj){ 
    selector2.innerHTML+='<option id="'+key+'"  >'+key+'</option>';
}

//clearTable(tb.rows.length);


//ourObj.forEach(function(item, i, arr) {
    //for (var key in ourObj){
  
   // }

   /*for (var key in ourObj){
    for (var i = 0; i < ourObj[key].length; i++) {
            //alert(ourObj[key].length);
    var tr = document.createElement('tr');
   // var id = key;

    //tr.id = `row-${id}`;
    tr.innerHTML = `<td>${ourObj[key][day]['consName']}</td>
                    <td>${ourObj[key][day]['quantity']}</td>`
                    
    tb.appendChild(tr);
    }
    }*/
    
//});
}

      
   </script>
</main>
<footer>
        <address>...</address>
        <small>@2019...</small>
  </footer>
  
</body>


</html>