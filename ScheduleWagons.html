<!DOCTYPE html>
<html lang="en">
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Forest</title>
  <link rel="stylesheet" href="provider.css ">
 <style>
 
 #nav li:hover ul li a:hover{ /* стили для конкретных выпадающих пунктов, при наведении на них курсора */
    
    background:rgba(50,50,50,1); /* Полупрозрачность. */
   
}
main{
    margin-top: 10%;
}
label{
    color: bisque;
    margin-top: 2px;
}
INPUT{
    margin-top: 2px;
}

#div{float: left;position: absolute; right: 0; top: 90px; width: 80%;

}
#butt{
    float: left;
    margin-top: 250px;
    margin-left: -120px;
    list-style: none;
}

  #left{
    position: absolute; left: 250px; top: 0; width: 30%;
  }
 </style>

 
</head>
<body>

 <header> 
<h1>Расписание вагонов</h1>

    <!--Меню-->
    <ul id="nav">
        <li>
            <a href="#" title="Меню"  id="menu" ><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/Hamburger_icon.svg/1200px-Hamburger_icon.svg.png" width="30px" height="30px"  ></a>
            <ul>
                <li><a href="SupplyScheme.html">График поставок </a></li>
                <li><a href="Consigner.html">Грузоотправители </a></li>
                <li><a href="Provider.html">Поставщики </a></li>
                <li><a href="Wagons.html">Вагоны </a></li>
                <li><a href="ProvCons.html">Взаимосвязь</a></li>
                <li><a href="page1.html">Настройки </a></li>
                <li><a href="site.html#">Главная </a></li>
            </ul>
        </li>
    </ul>

 </header>
 
<main>
<section> 
<div id="leftCol">
        <form id="typeTbl" action="select1.php" method="post" onchange="change()">
            <p id="typeWag">Выберите тип вагона</p>
                <p><select size="1" name="type" id="type">
                <option disabled selected></option>

                </select></p>        
        </form>

        <form id="monthTbl" action="select1.php" method="post">
                <p id="dateWag">Выберите месяц</p>
                    <p><select size="1" name="type" id="month">
                        <option disabled selected></option>
                        <option id="1" value="Январь"  >Январь</option>
                        <option id="2" value="Февраль"  >Февраль</option>
                        <option id="3" value="Март"  >Март</option>
                        <option id="4" value="Апрель"  >Апрель</option>
                        <option id="5" value="Май"  >Май</option>
                        <option id="6" value="Июнь"  >Июнь</option>
                        <option id="7" value="Июль"  >Июль</option>
                        <option id="8" value="Август"  >Август</option>
                        <option id="9" value="Сентябрь"  >Сентябрь</option>
                        <option id="10" value="Октябрь"  >Октябрь</option>
                        <option id="11" value="Ноябрь"  >Ноябрь</option>
                        <option id="12" value="Декабрь" >Декабрь</option>
                    </select></p>                   
        </form>

    <li id="butt">
        <button id="myBtn" >Создать</button>
        <!--<input type="button" id="button" value="Создать">-->
        <input type="button" id="save" value="save">
    </li>
    <div id="daysDisplay"></div>    
</div>



<div id="div" >
    <br> 
</div>

  
</section>


<script type="text/javascript">

window.onload = function (){ 


//типы
var typeWagon;

//1. Создаём новый объект XMLHttpRequest
    var xhr = new XMLHttpRequest();
    
    xhr.open('GET', 'http://kappa.cs.petrsu.ru/~akulov/Practice/actionsFiles.php?wagon=1',false);
    
     // 3. Отсылаем запрос
    xhr.send();
    
   // 4. Если код ответа сервера не 200, то это ошибка
    if (xhr.status != 200) {
      // обработать ошибку
    console.log(xhr);
    alert( xhr.status + ': ' + xhr.statusText );  //пример вывода: 404: Not Found
    } else {
    
        typeWagon = JSON.parse(xhr.responseText);
    
      
    }
    var selector=document.getElementById('type');

   for (i = 0; i < typeWagon.length; i++) {
   	for (var key in typeWagon[i]) {
    
   			selector.innerHTML+='<option id="'+key+'"  >'+key+'</option>'
            
   	}
   }
}


var select, value, text,value;

function change() {
    select = document.getElementById("type"); // Выбираем  select по id
    typeId=select.selectedIndex;
    value = select.options[select.selectedIndex].value; // Значение value для выбранного option
    text = select.options[select.selectedIndex].text; // Текстовое значение для выбранного option
    alert("typeId:" + typeId + "\nValue: " + value + "\nТекст: " + text ); // Вывод алерта для проверки значений
}
//if(document.getElementById(type)==1) {
 //   alert('ura');
//}

//получение количества дней в выбранном месяце
var monthData;
var count;
Date.prototype.daysInMonth = function(month) {
   
            this.dirMonth = {
                    'Январь': 0, 
                    'Февраль': 1,  
                    'Март': 2, 
                    'Апрель': 3, 
                    'Май': 4, 
                    'Июнь': 5, 
                    'Июль': 6, 
                    'Август': 7,
                    'Сентябрь': 8, 
                    'Октябрь': 9, 
                    'Ноябрь': 10, 
                    'Декабрь':11
            }
                return 33 - new Date(this.getFullYear(), this.dirMonth[month], 33).getDate();
	  };

var date = new Date();
var generateBtn = document.getElementById('myBtn');
var daysInMonth = '';
var k=0;
generateBtn.addEventListener('click', GenerateRowsTbl);

function GenerateRowsTbl(evt) {
      var monthsSelect = document.getElementById('month');
      var months = monthsSelect.options;
      var month = months[months.selectedIndex].text;
      daysInMonth = date.daysInMonth(month);
      var divDay = document.getElementById('daysDisplay');
    
   


    

//Создание таблицы

k++;//проверка для того,чтобы не дублировать несколько месяцев
if(k==1){
        for(count=0;count<daysInMonth;count++) {
                    var input = document.createElement('INPUT');
                    input.type = 'text';
                    input.setAttribute("data-id", "id" + count);
                    input.setAttribute("class", "test");
                    input.name = "value[]";
                    var newlabel=document.createElement('label');
                    newlabel.innerHTML=count+1;
                    var br=document.createElement('br');

                    document.querySelector('#div').appendChild(newlabel);
                    document.querySelector('#div').appendChild(input);
                    document.querySelector('#div').appendChild(br);

   } }
    else location.reload(); 
   
 
//});
 } 
 document.getElementById('save').onclick=function(){
var arr = document.getElementsByClassName("test")[0].value;

var str="table=schedule&SWagType="+value+"&action=edit&day="+daysInMonth;
for(i=1;i<daysInMonth;i++){
    str+="&"+i+"="+document.getElementsByClassName("test")[i].value;
}
alert(str);

}

//отправка данных на сервер
 // 1. Создаём новый объект XMLHttpRequest
 var xhr = new XMLHttpRequest();
                
                 xhr.open('GET', 'http://kappa.cs.petrsu.ru/~akulov/Practice/actionsFiles.php?' + str,false);

                // 3. Отсылаем запрос
                xhr.send();
                // Обновление страницы
                location.reload();
                alert("Грузоотправитель удален.");





   </script>

</main>

<footer>
        <address>...</address>
        <small>@2019...</small>
</footer>
  
</body>
</html>